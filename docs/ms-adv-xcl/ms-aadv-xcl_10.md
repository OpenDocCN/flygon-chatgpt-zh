# [第9章数据透视表](contents.xhtml#ch09a)

[介绍](contents.xhtml#sc2_104a)

数据透视表是一种基于交互式工作表的表格，可以快速汇总大量数据，使用您选择的格式和计算方法。它被称为数据透视表，因为您可以围绕核心数据区域旋转其行和列标题，以便为您提供源数据的不同视图。随着源数据的变化，您可以更新数据透视表。它驻留在工作表上，因此，您可以使用标准公式将数据透视表集成到更大的工作表模型中。您可以使用数据透视表分析Excel工作簿中的数据，或者来自外部数据库，如MS Access或SQL Server。

[结构](contents.xhtml#sc2_105a)

在本章中，我们将讨论以下主题：

+   检查数据透视表

+   推荐的数据透视表

+   创建数据透视表

+   总计的百分比

+   使用数据透视数据创建图表

+   切片器

+   时间轴

+   Power View

+   Power Pivot

+   数据模型的好处

+   使用 Power Pivot 创建数据透视表

[目标](contents.xhtml#sc2_106a)

学习本章后，读者将能够创建数据透视表，使用数据透视表制作不同的报告，以及使用数据透视表的高级功能。

[检查数据透视表](contents.xhtml#sc2_107a)

数据透视表所基于的数据称为源数据。每列代表一个字段或信息类别，您可以将其分配给数据透视表的不同部分，以确定数据的排列方式。您可以添加四种类型的字段，这些字段在以下[表9.1](#tab9-1)中进一步解释：

| 字段 | 描述 |
| --- | --- |
| 报告筛选器 | 在数据透视表中筛选汇总数据。如果在报告筛选器中选择一个项目，则数据透视表的视图仅变化以显示与该项目相关的汇总数据。例如，如果区域是一个报告筛选器，您可以显示北部、西部或所有区域的简短数据。 |
| 行标签 | 行显示字段中的项目作为标签。例如，行标签季度字段包含值，这意味着表格显示每个季度的一行。 |
| 列标签 | 列标签是产品字段的值，这意味着表格显示每个产品的列，在显示项目为列标签的字段中。 |
| Σ 值 | 包含汇总数据。这些字段通常包含数值数据，例如销售和库存，在数据出现的区域称为数据区域。 |

表9.1：数据透视表中的字段类型

参考以下[图9.1](#fig9-1)：

![](images/Figure_9.1.png)

图9.1：数据透视表的字段

选择数据范围中包含每列顶部行的标题的任何单元格。在“表格”组中，点击“数据透视表”按钮，或点击“数据透视表”列表并选择“数据透视表”。在“表/范围”框中，选择包含数据的范围以在数据透视表中使用。选择数据透视表的位置。你可以将数据透视表放在新工作表或现有工作表中。点击“确定”创建数据透视表。

你可以向数据透视表添加字段以指定要显示的数据。源数据的字段显示在“数据透视表字段列表”任务窗格中。要添加字段，将相关字段从“数据透视表字段列表”顶部拖动到底部的四个区域之一。你可以向一个区域添加多个字段，并且不需要将所有字段都添加到表中。

要显示数据，使用“行标签”列表中的数据和“数值”中的数字：

1.  激活“插入”选项卡，打开“创建数据透视表”对话框。

1.  只需添加字段标题，你需要将至少一个字段放在“数值”区域。

字段就位后，你可以通过在筛选列、筛选行或筛选列表中从报告中选择信息来过滤出现在表中的信息。例如，你可以显示所有数据值或限制数据透视表仅总结其中的一部分。

[推荐的数据透视表](contents.xhtml#sc2_108a)

检查数据透视表的推荐。为此，选择数据库并点击“插入”选项卡。点击推荐的数据透视表选项，如下所示[图 9.2](#fig9-2)：

![](images/Figure_9.2.png)

图 9.2: 推荐的数据透视表

或者，简单地选择数据以制作数据透视表。点击右下角的按钮，选择表选项以创建数据透视表报告。

[创建数据透视表](contents.xhtml#sc2_109a)

要开始我们的分析，我们将使用提供的销售数据创建一个数据透视表。按照之前提到的步骤设置一个包括 REP、CUSTNAME、PRODUCT、DATE、QTY、CP、S.P. 和 NET 等必要字段的数据透视表。我们将使用这些字段从不同角度分析销售数据。

按照给定的步骤：

1.  选择包括标题在内的整个数据范围。你可以通过点击并拖动鼠标跨越数据或使用键盘快捷键（例如，Ctrl+A）来完成这个操作。参考[图 9.3](#fig9-3)：

    ![](images/Figure_9.3.png)

    图 9.3: 销售数据

1.  在 Excel 中，转到“插入”选项卡，然后点击“数据透视表”按钮，如[图 9.4](#fig9-4)所示：

    ![](images/Figure_9.4.png)

    图 9.4: 插入数据透视表

1.  会出现一个“创建数据透视表”对话框。确保你选择的数据范围正确，并选择要放置数据透视表的位置（例如，新工作表或现有工作表）。参考[图 9.5](#fig9-5)。

1.  点击“确定”创建数据透视表。

    ![](images/Figure_9.5.png)

    图 9.5: 表/范围

1.  透视表字段列表将显示在屏幕右侧。此列表包含您的销售数据的列标题。参考[图 9.6](#fig9-6):

    ![](images/Figure_9.6.png)

    图 9.6: 按客户分组的数量

1.  从字段列表中将所需字段拖放到透视表的不同区域。

1.  将“CUSTNAME”字段拖动到“行”区域，按客户名称对数据进行分组。

1.  将“QTY”字段拖动到“值”区域以计算总销售数量。参考[图 9.7](#fig9-7):

    ![](images/Figure_9.7.png)

    图 9.7: 值字段设置

1.  您可以通过单击“值”区域中字段名称旁边的下拉箭头并选择不同的计算（例如，平均值、计数）来更改汇总函数。参考[图 9.8](#fig9-8):

    ![](images/Figure_9.8.png)

    图 9.8: 总和和平均值

[总计的百分比](contents.xhtml#sc2_110a)

要查找总计的百分比，请按照以下步骤操作：

1.  右键单击透视表中“Qty”列中的任何值。

1.  从上下文菜单中选择“值字段设置”或“值设置”。

1.  在弹出的对话框中，选择“总计百分比”或“总计的百分比”选项（确切的措辞可能因您的电子表格软件而异）。

1.  点击“确定”以应用计算。

1.  现在，透视表将显示每个客户或分组的总计百分比在“Qty”列中。

参考[图 9.9](#fig9-9):

![](images/Figure_9.9.png)

图 9.9: 总计百分比

[在透视表中对项目进行分组](contents.xhtml#sc3_111a)

如果您想要根据当前年份或年度季度准备报告，则可以在透视表中使用分组选项。按照以下步骤操作：

1.  选择数据范围中的任何单元格。

1.  激活“选项”选项卡。

1.  单击“分组字段”。

1.  在“按”框中，单击一个或多个时间段以进行分组。

[日期分组](contents.xhtml#sc3_112a)

要对日期进行分组，请按照以下步骤操作：

1.  假设您已经创建了一个带有日期字段的透视表，并将其放置在“行”或“列”区域中，请继续下一步。

1.  右键单击透视表中日期列中的任何日期值。

1.  在弹出的上下文菜单中，选择“分组”或“分组字段”（具体措辞可能因您的电子表格软件而异）。

1.  在分组对话框中，选择“月份”选项。

1.  点击“确定”以应用分组。

1.  现在，透视表将按月份对日期列进行分组，每个月份在透视表中显示为单独的项目。

参考[图 9.10](#fig9-10):

![](images/Figure_9.10.png)

图 9.10: 日期分组

[按月份报告](contents.xhtml#sc3_113a)

月份报告可以在以下[图 9.11](#fig9-11)中查看：

![](images/Figure_9.11.png)

图 9.11: 按月份

[使用数据透视表创建图表](contents.xhtml#sc2_114a)

您可以使用数据透视图表来图形化显示数据。单个数据透视图表提供相同数据的不同视图。创建数据透视图表时，数据透视表的行字段变为类别，列字段变为系列。

要创建一个数据透视图表，选择数据透视表内的任何单元格，然后在“选项”选项卡上的“工具”组中点击“图表”。选择图表的选项，然后点击“确定”。您也可以通过在源数据中选择一个单元格，并在“插入”选项卡的“表格”组中的“数据透视图表”列表中选择“数据透视图表”来同时创建新的数据透视图表和数据透视图表。参考[图 9.12](#fig9-12)：

![](images/Figure_9.12.png)

图 9.12：按月份图表

要按月份和年份对数据透视表中的日期列进行分组：

1.  右键单击数据透视表中日期列中的任何日期值，然后选择“组”。

1.  在分组对话框中，选择“月份”选项，并同时选择“年份”选项。最后，点击“确定”应用分组。

参考[图 9.13](#fig9-13)：

![](images/Figure_9.13.png)

图 9.13：按年度月份分组

要在数据透视表中按年份和季度对日期列进行分组，请按照以下步骤进行：

1.  右键单击数据透视表中日期列中的任何日期值，然后选择“组”。

1.  在分组对话框中，选择“季度”选项，并同时选择“年份”选项。最后，点击“确定”应用分组。（这里Qtr1指一月、二月、三月）

参考[图 9.14](#fig9-14)：

![](images/Figure_9.14.png)

图 9.14：按年度季度分组

[周报表](contents.xhtml#sc3_115a)

如果您在日期字段上进行了分组，可以按周对项目进行分组。在“按”框中点击“天”，并确保“天”是唯一选择的时间段。然后在“天数”框中点击7。

参考[图 9.15](#fig9-15)：

![](images/Figure_9.15.png)

图 9.15：按天分组

现在，数据透视表将按天分组显示数据，使您可以查看按日汇总的周报表，如[图 9.16](#fig9-16)所示：

![](images/Figure_9.16.png)

图 9.16：周报表

[数字分组（创建区间）](contents.xhtml#sc3_116a)

对于数字的分组，请按照以下步骤进行：

1.  右键单击数据透视表中“净值”列中的任何值。

1.  从上下文菜单中选择“组”或“组字段”选项。参考[图 9.17](#fig9-17)：

    ![](images/Figure_9.17.png)

    图 9.17：按数字分组

1.  在分组对话框中，指定您的分组区间的起始值。例如，如果您想从0开始，就在“从”字段中输入0。

1.  在“按”字段中，输入您想要使用的区间大小。在这种情况下，输入1000。

1.  点击“确定”应用分组。

数据透视表现在将显示“净值”列，其值分组为1000的区间。这种分组方式使您可以根据定义的区间分析“数量”值。

[切片器](contents.xhtml#sc2_117a)

切片器是易于使用的过滤组件，包含一组按钮，使您可以快速过滤数据透视表报告中的数据，无需打开下拉列表以查找要过滤的项目。当您使用常规数据透视表报告筛选器来筛选多个项目时，筛选器指示仅筛选了多个项目，并且您必须打开下拉列表以查找筛选详细信息。然而，切片器清楚地标记了应用的筛选器，并提供详细信息，以便您可��轻松理解在过滤的数据透视表报告中显示的数据。参考 [图 9.18](#fig9-18)：

![](images/Figure_9.18.png)

图 9.18：按天分组

按照以下步骤进行：

1.  选择数据透视表中的任何单元格。

1.  转到 Excel 标签中的数据透视表分析或分析选项卡。

1.  定位筛选组，然后点击“插入切片器”按钮。

1.  在“插入切片器”对话框中，选中“客户名称”旁边的复选框以选择它。参考 [图 9.19](#fig9-19)：

    ![](images/Figure_9.19.png)

    图 9.19 切片器

1.  点击“确定”按钮以插入切片器。参考 [图 9.20](#fig9-20)：

    ![](images/Figure_9.20.png)

    图 9.20：按客户名称切片器

1.  将一个切片器添加到您的工作表中。您可以根据需要调整大小和重新定位。

1.  使用切片器通过选择要包含或排除的特定“客户名称”值来筛选数据透视表中的数据。

[时间轴](contents.xhtml#sc2_118a)

现在，您可以使用数据透视表时间轴而不是玩弄筛选器来显示日期。它是一个可以添加到您的数据透视表中的框，让您可以按时间筛选，并放大您想要的时间段。点击“分析” | “插入时间轴”来调用它。参考 [图 9.21](#fig9-21)：

![](images/Figure_9.21.png)

图 9.21：时间轴

[图 9.22](#fig9-22) 显示了日期时间轴：

![](images/Figure_9.22.png)

图 9.22：日期时间轴

[Power View](contents.xhtml#sc2_119a)

Power View 加载项允许您以视觉上引人注目的方式定义工作表的摘要，特别强调您需要的变量。通过一个单独的选项卡，您可以选择最适合您的方式查看数据。在定义相关的 Power 字段之后，Power View 从所选工作表中提取信息，以便根据指定的查看筛选器给出完整的概述。

此外，您可以选择新的主题、背景、透明度、图片和其他内容，自由插入、修改、排列和分析关系，有效地。按照以下步骤进行：

1.  选择数据。

1.  点击“插入”选项卡。

1.  点击“Power View”选项。

1.  您可以看到带有数据字段的图像 Power View 外观。

利用右侧的筛选按钮，可以根据所有列字段的帮助，按照自己的意愿筛选数据。

您可以利用字段列表查看各种计算，如总和、最小值、最大值、平均值等。此外，通过使用薪资参数，您可以根据所选范围检查和查看数据。这是 Power View 选项的整体外观。

[Power Pivot](contents.xhtml#sc2_120a)

Power Pivot 是一个插件，我们可以在 Excel 中进行强大的数据分析。该插件内置于 Excel 中，但未启用。要启用 Power Pivot，请按照以下步骤操作：

1.  转到“文件”选项卡。

1.  点击“选项” | “加载项”。

1.  在“管理”框中，点击“COM 加载项”。

1.  前往 COM 加载项中的 MS Office Power Pivot 进行检查。

这是一种用户友好的方式，使用您已经熟悉的 Excel 功能进行数据分析，例如 Office Fluent 用户界面、数据透视表和数据透视图以及切片器。通过 Power Pivot，我们可以快速整合来自各种来源的大量数据，快速进行信息分析，并轻松共享见解。

[数据模型的优势](contents.xhtml#sc2_121a)

在 Excel 和 Power Point 中，您可以创建一个数据模型，这是一个具有关系的表格集合。在 Excel 工作簿中看到的数据模型与在 Power Pivot 窗口中看到的数据模型类似。您导入到 Excel 中的任何数据都可以在 Power Point 中使用，反之亦然。

数据模型是反映业务运营和流程之间 RE-L 世界关系的表格及其关系的集合；例如，产品与库存和销售之间的关系。

按照给定的步骤进行操作：

1.  将数据转换为表格。

1.  将 Excel 表格导入 Power Pivot。

    1.  表字段列表可以在数据透视表中有多个表。

    1.  我们可以基于一个共同字段在表格之间建立关系，这样您就不需要使用查找。

    1.  Power View 是由数据模型启用的。

[使用 Power Pivot 创建数据透视表](contents.xhtml#sc2_122a)

我们有四个不同工作表中的四个数据：城市详情、客户、订单和订单详情，需要创建一个按城市划分的报告，关于总销售数量。因此，我们需要按照给定的步骤进行操作：

1.  选择数据

    1.  转到主页选项卡。

    1.  选择样式组。

    1.  格式化为表格。

    1.  点击“设计”选项卡。

    1.  在“属性”组中，为表格命名。

1.  选择 Power Pivot 选项卡。

    1.  转到“表格”组。

    1.  添加到数据模型。所有表格都将添加到数据模型中。

1.  定义关系。

    1.  转到 Power Pivot 视图中的主页选项卡。

    1.  从“查看”选项卡中选择“图表”视图。

    1.  然后拖放共同字段以创建两个表格之间的链接。

1.  在“查看”选项卡中选择“数据”视图。

1.  点击主页选项卡上的数据透视表。

1.  创建数据透视表。

1.  从表格（活动和全部）中选择字段。具有黑色边框的表格表示它们与其他表格链接。

1.  从城市详情中选择城市名称，从订单详情中选择数量��

[结论](contents.xhtml#sc2_123a)

总的来说，关于数据透视表的章节提供了对Excel中这一强大工具进行数据分析和报告的全面理解。数据透视表允许用户快速高效地总结和分析大量数据，提供不同的视角和洞察数据。

该章节涵盖了各种主题，包括检查数据透视表、推荐的数据透视表选项、格式化数据透视表报告、使用数据透视数据创建图表、利用切片器和时间线进行数据过滤，以及探索高级功能如Power View和Power Pivot。

通过按照章节中提供的逐步说明和示例，读者可以学习如何创建数据透视表，根据其分析需求自定义它们，并利用高级功能来增强其数据分析和报告能力。

总体而言，数据透视表提供了一种灵活动态的探索和展示数据的方式，使用户能够根据总结的信息获得有价值的见解，并基于此做出明智的决策。通过掌握数据透视表，用户可以高效地分析数据，发现趋势，并有效地传达他们的发现。

[练习](contents.xhtml#sc2_124a)

1.  打开包含销售数据的Excel电子表格。

1.  创建一个数据透视表来计算每个产品类别的总销售收入。

1.  格式化数据透视表，使其视觉上吸引人且易于阅读。

1.  创建一个数据透视图表来表示各产品类别的销售收入。

1.  创建另一个数据透视表来确定销售收入最高的地区。

1.  创建一个数据透视图表来可视化各地区的销售收入。

1.  创建一个数据透视表来分析每月销售收入。

1.  使用条件格式设置来突出显示任何重大变化或趋势。

1.  创建一个数据透视表来计算每个产品类别的平均销售收入。

加入我们书籍的Discord空间

加入书籍的Discord工作空间，获取最新更新、优惠、全球科技动态、新发布和与作者的交流会话：

**[https://discord.bpbonline.com](https://discord.bpbonline.com)**

![](images/fm1.png)
