# [第3章使用公式和函数](contents.xhtml#ch03a)

[介绍](contents.xhtml#sc2_32a)

在本章中，我们将探讨在Microsoft Excel中使用公式和函数的方法。公式是对值进行计算的方程式，而函数是预定义的简化复杂任务的公式。我们将涵盖诸如在工作表中使用公式、数组公式、使用函数、IF函数及其变体以及查找函数等主题。

[结构](contents.xhtml#sc2_33a)

在本章中，我们将讨论以下主题：

+   在工作表中使用公式

+   使用函数

+   查找函数

+   使V-Lookup动态

+   索引

[目标](contents.xhtml#sc2_34a)

在学习本章之后，读者将能够理解公式和函数的用法，识别不同类型的函数，并了解IF和其他逻辑函数的工作原理。

[在工作表中使用公式](contents.xhtml#sc2_35a)

公式是对值进行计算的方程式。公式以等号(=)开头。它至少包含两个操作数和一个操作。例如，以下公式将2乘以3，然后将5加到结果中。

=5+2*3

公式中的操作数可以是函数、引用或常数。运算符可以是任何算术或逻辑运算符。

注意：在Excel中，当涉及多个运算符时，遵循BODMAS规则来解决公式。

[数组公式](contents.xhtml#sc3_36a)

在[图3.1](#fig3-1)中，有五种产品，我们知道其数量和价格。我们需要找到总销售额，这是将所有产品的数量和价格相乘相加的结果。在正常情况下，我们将分别计算每种产品的金额，然后将它们相加以获得答案。但是，为了简化事情，我们也可以使用数组公式。选择B8并写入=sum(A2:A6*B2:B6)，然后按Ctrl + Shift + Enter组合键填充公式{=sum(A1:A3*B1:B3)}到所选单元格中，如[图3.2](#fig3-2)所示。这将计算单元格B8中所有产品的数量*价格。

注意：公式周围的大括号({})表示它应用于数组。

[图3.1](#fig3-1)展示了五种产品的数量和价格：

![](images/Figure_3.1.png)

图3.1：五种产品的数量和价格

[图3.2](#fig3-2)展示了所有产品的数量*价格：

![](images/Figure_3.2.png)

图3.2：所有产品的数量*价格

[使用函数](contents.xhtml#sc2_37a)

对一系列单元格中的每个值进行计算可能会很复杂且耗时。例如，如果您有一个包含20个单元格的范围，一个将这些值相加的公式将会非常长。Excel函数简化了复杂的任务。

函数是执行特定计算或其他操作的预定义公式，对数字或文本字符串进行操作并返回一个值。您可以指定函数执行计算的值。函数的语法以函数名称开头，后跟一个开括号，由逗号分隔的函数参数和一个闭括号。 

如果函数开始一个公式，请在函数名称前键入等号（=）。当您创建包含函数的公式时，公式面板将为您提供帮助，如下所示[图3.3](#fig3-3)：

![](images/Figure_3.3.png)

图3.3：插入函数

注意：从空单元格开始，您可以单击公式栏附近的fx符号以查看Excel中所有可用的函数。

函数的语法是：

| =函数名称（参数1，参数2，…） |
| --- |

示例：

| =SUM(A10, B5:B10, 50, 37) |
| --- |

没有必要记住所有可用的函数以及每个函数所需的参数。相反，您可以使用用于求和的sigma符号（∑），或单击下拉菜单以获取更多函数，如Max、Min等。Excel会提示您所需和可选的参数。

注意：您可以使用Alt + =组合键在工作表上获取求和函数。

[IF函数](contents.xhtml#sc3_38a)

在[第二章](ch02.xhtml)中，单元格引用和范围，我们已经学习了诸如HRA和DA之类的收入头的计算。我们看到的公式对整个数据库都是相同的。根据某些条件，我们需要决定应用的公式。例如，奖励可能根据部门计算。这就是条件函数如“IF”出现的地方。

IF函数可用于评估条件。根据条件，无论是真还是假，IF函数都会返回值。IF函数的语法是：

| If(logical_test, [Value_if_true], [Value_if_false]) |
| --- |

第一个参数是函数需要评估的条件。第二个参数是条件为真时返回的值，第三个参数是条件为假时返回的值。第二和第三个参数是可选的。

示例：

假设您想根据员工的职位计算HRA。如果职位是经理，那么HRA是1000，否则是500。那么函数代码将如下所示：

| =if(C2="经理", 1000, 500) |
| --- |

参考[图3.4](#fig3-4)：

![](images/Figure_3.4.png)

图3.4：IF函数

如[图3.4](#fig3-4)所示，上述函数计算经理的HRA为1000，其他人为500。

[嵌套IF](contents.xhtml#sc3_39a)

当第二个IF函数放置在第一个顺序内以测试附加条件时，将使用嵌套IF函数。

嵌套IF函数的语法是：

| If(logical_test, [Value_if_true], If(logical_test, [Value_if_true], [Value_if_false])) |
| --- |

示例：

您可以使用嵌套的IF函数来评估复杂的条件。例如，如果工资<5000，则税率为5%。如果工资在5000到1000之间，则为10%，否则为15%。由于我们已经给工资列命名为sal，因此可以使用sal代替h2 =if (sal<5000, salary*.05, if (sal<10000, salary*.10, sal*.15))。参考[图3.5](#fig3-5)：

![](images/Figure_3.5.png)

图3.5：使用嵌套IF函数

假设您想要为名称为平均分数的数字分配字母等级，如下所示的[表3.1](#tab3-1)：

| 如果平均分数为 | 返回 |
| --- | --- |
| 大于89 | A |
| 从80到89 | B |
| 从70到79 | C |
| 从60到69 | D |
| 少于60 | F |

表3.1：分配字母等级

您可以使用以下嵌套的IF函数：

| IF（AverageScore>89，“A”，IF（AverageScore>79，“B”，IF（AverageScore>69，“C”，IF（AverageScore>59，“D”，“F”））） |
| --- |

注意：您可以在单个公式中嵌套最多64个级别的IF函数。

[带有AND的IF](contents.xhtml#sc3_40a)

在Excel中，OR是一个逻辑函数，如果任何一个参数返回false，则返回false。

语法：

| AND（逻辑1，逻辑2...） |
| --- |

���果存在这样的情况，即我们有两个条件，其联合真值将决定IF函数的输出，则可以使用AND与IF。

语法：

| 如果（和（条件1，条件2….），真，假） |
| --- |

示例：

如果我们需要给在“销售”部门工作且在“北部”地区的每个人提供基本工资的10%作为激励，我们将使用以下公式：

=IF (AND (Department=”sales”, Region=”north”), 10%*基本工资, 0)

[带有OR的IF](contents.xhtml#sc3_41a)

OR是Excel中的逻辑函数，如果任何一个参数返回false，则返回False。

语法：

| OR（逻辑1，逻辑2...） |
| --- |

如果存在这样的情况，即我们有两个条件，其中任何一个条件为假，则IF应返回假参数中的值，我们可以在IF中使用OR。

使用OR与IF的语法

| 如果（OR（条件1，条件2….），真，假） |
| --- |

示例：

如果员工在销售、市场营销或人力资源部门，则HRA为基本工资的50%。否则，它是基本工资的30%。

如果（或（Department=”Mktg”，Department =”Sales”，Department=”Hrd”），基本工资*.5，基本工资*.3）

[带有NOT的IF](contents.xhtml#sc3_42a)

这是一个用于否定参数的逻辑函数。

语法：

| NOT（逻辑） |
| --- |

如果我们有一个条件，当不满足时，我们需要应用公式，我们可以使用NOT与IF。

使用NOT与IF的语法

| 如果（NOT（条件），真，假） |
| --- |

示例：

如果我们需要给除了在“市场营销”部门工作的人之外的所有人提供激励，我们可以使用以下公式：

IF（NOT（Department=”MT”），10%*工资，0）

注意：最多可以传递255个条件给AND/OR函数，而NOT函数只能传递一个条件。

我们还可以在IF内部使用多个NOT。

示例：

如果你需要给每个人提供激励，但不包括销售和行政部门的人员，你可以使用以下函数：

如果（并且（不是（部门=”销售”），不是（部门=”行政”）），10%*工资，0）

[查找函数](contents.xhtml#sc2_43a)

有时，我们需要根据查找值在数据库中搜索数值。例如，给定员工ID，我们如何从其他表或其他文件中查找激励值？在这种情况下，根据源数据库，我们可以使用以下查找函数之一：

+   V-lookup（如果数据库是垂直的）。参考[图3.6](#fig3-6)：

    ![](images/Figure_3.6.png)

    图3.6：V-lookup

+   H-lookup（如果数据库是水平的）：参考[图3.7](#fig3-7)：

    ![](images/Figure_3.7.png)

    图3.7：H-lookup

[V Lookup](contents.xhtml#sc3_44a)

如果我们需要根据一个共同字段从其他文件或表中获取列的值，可以使用V-lookup。V-lookup是一个函数，它在给定数据库（表格数组）的最左列中搜索一个值（查找值），并返回你指定列中相同行的值。

语法：

| VLOOKUP (lookup_value, table_array, col_index_num, range_lookup) |
| --- |

您可以通过使用内置函数参数对话框来编写此函数。单击公式选项卡，在查找和引用类别中搜索vlookup。您将获得一个函数参数对话框，如[图3.8](#fig3-8)所示：

![](images/Figure_3.8.png)

图3.8：V-lookup函数参数

这里可以选择的不同数值如下：

+   Lookup_value：要在表格的第一列中找到的值。这是你要查找的值。Lookup_value可以是一个值，一个引用或一个文本字符串。

+   Table_array：查找数据的信息表。这是源数据库。使用范围引用或范围名称。

+   Col_index_num：从中返回匹配值的table_array中的列号。

+   Range_lookup：逻辑值，指定是否要让VLOOKUP找到精确匹配还是近似匹配。如果Range Lookup设置为FALSE或0，VLOOKUP将找到精确匹配。如果找不到精确匹配，将返回错误值#N/A。如果设置为TRUE或非零，它会找到小于查找值的最近值。

[H-lookup](contents.xhtml#sc3_45a)

H-lookup函数在表格的最顶行中搜索数值，然后返回你指定行中相同列的数值。

语法：

| HLOOKUP (lookup_value, table_array, row_index_num, range_lookup) |
| --- |

H-lookup与V-lookup的工作方式相同。但在这种情况下，我们需要指定行索引号，而不是列索引号。

注意：你也可以通过以下方式获取函数参数框。输入 =VLOOPUP（或=HLOOKUP（视情况而定）并按Ctrl + A。

[带有范围0（False）的Vlookup示例：](contents.xhtml#sc4_46a)

假设您想根据激励表在工资表中添加激励，激励表的范围在激励工作表中为A1:B12。按照以下步骤操作：

1.  选择要放置结果的单元格。

1.  点击插入函数。从查找和引用类别中选择Vlookup()函数。

1.  查找值：选择A2 [员工代码]

1.  表数组：选择激励表并从$A$1:$B$12中选择范围[即，员工代码和激励列]

1.  列索引：输入2 [列2是激励表中的激励列]

1.  范围查找：输入False [我们正在从表中搜索查找值的精确匹配]

要消除#NA（不可用错误），您可以使用Iferror函数。iferror的语法如下：

| = iferror (vlookup….,"") |
| --- |

[带有非零范围的Vlookup示例（True）](contents.xhtml#sc4_47a)

假设您想根据工资分级添加激励。在这种情况下，您可以使用带有True范围的Vlookup，而不是IF条件。在这种情况下，我们将创建一个表，如[表3.2](#tab3-2)。在表数组中，选择此表，并在范围查找字段中，输入“True”而不是“False”。

| 0 | 2% |
| --- | --- |
| 5000 | 5% |
| 10000 | 10% |
| 15000 | 15% |

表3.2：示例表

注意：在这种情况下，表将按照第一列升序排序。

示例：

在高级Excel作业文件中，emp_inf表，我们需要根据员工ID检索员工信息。为此，我们可以使用vlookup，如下所示[图3.9](#fig3-9)：

![](images/Figure_3.9.png)

图3.9：带有非零范围的Vlookup示例

要查找其他详细信息，您可以使用相同的公式，并相应更改列索引号。

[使V-Lookup动态化](contents.xhtml#sc2_48a)

当我们有一个动态数据库，其中新列经常添加到数据库中时，当前列的位置也可能会改变。然而，Vlookup的列索引号不会随着数据库的增长而自动更新。这就是我们需要使VLookup动态化的地方，以便获取列索引号。为此，我们可以使用以下函数之一动态检索列索引号：

+   列

+   匹配

[在Vlookup中使用列函数](contents.xhtml#sc3_49a)

要使Vlookup动态化，我们可以使用列标题作为指示器，动态地选择所需值存在的特定列的索引号。在vlookup中使用列函数的语法是：

| = vlookup (lookup_value, table_array, COLUMN (reference), Range_lookup) |
| --- |

在这里，列函数的参考参数将包含原始数据库中列标题的单元格引用。

示例:

在上述vlookup示例中，如果我们需要动态查找列索引号，我们可以使用列函数，如下所示[图3.10](#fig3-10)：

![](images/Figure_3.10.png)

图3.10：在Vlookup中使用列函数

B1是“工资”工作表中“名字”列的列标题的引用。

[在V-Lookup中使用Match函数](contents.xhtml#sc3_50a)

正如我们在前面的案例中看到的，我们需要访问原始数据库或至少知道列的当前位置。然而，这些信息并不总是为我们所拥有。因此，在这里，我们需要使用一个可以通过名称仅检索列标题位置的函数。

Match函数也是一样。Match函数返回范围内字符串的位置。

match函数的语法如下：

| 匹配（查找值，查找数组，[匹配类型]） |
| --- |

可选择的各种选项是：

+   查找值：我们正在查找的字符串。它可以是一个字符串，例如“工资”，或存储字符串的单元格引用。

+   查找数组：我们需要知道查找值位置的范围。

+   匹配类型：这是一个可选参数，用于指定我们需要的匹配类型0：精确匹配，1：小于，-1：大于。

示例：

如果我们需要找出“salary”字符串在工资表第一行中的位置，我们会写，

| =match("salary", salary!$1:$1, 0) |
| --- |

我们可以使用match函数而不是列索引号来动态获取列索引号。

在vlookup中使用match函数的语法是：

| =vlookup(lookup_value, table_array, match(label,源数据库的第一行标签,0), Range_lookup) |
| --- |

示例：

在emp_inf示例中，如果我们需要使用列标题使vlookup更加动态，我们可以使用match与vlookup，如[图3.11](#fig3-11)所示。在这里，match查找工资数据库标题中每个字段的标签，并动态返回列的位置：

![](images/Figure_3.11.png)

图3.11：vlookup中的match函数

[索引](contents.xhtml#sc2_51a)

有时，我们需要根据其行号和列号在数据库中查找数据。索引函数帮助我们做到这一点。

索引函数的语法如下：

| 索引（数组，行号，[列号]） |
| --- |

正如您所看到的，您可以使用索引函数的两种方式。第一种语法用于在单个数据库中查找数据，第二种语法用于涉及多个数据库时使用。

示例：

假设我们需要在数据库的第3行和第4列的交叉点找到数据。在这种情况下，我们可以使用以下函数：

| =index(database, 3, 4) |
| --- |

[索引-匹配](contents.xhtml#sc3_52a)

正如我们之前学过的，vlookup是根据数据库第一列的值来查找数据。然而，如果我们有一个数据库，其中我们的查找值在中间，我们需要向左搜索，我们必须将列移动到最左上角，然后再使用vlookup。当与match一起使用时，索引函数帮助我们搜索数据，即使查找值不在最左列上。

index-match的语法如下：

| INDEX (数组, [MATCH (查找值, 查找数组, [匹配类型])], [Match (查找值, 查找数组, [匹配类型])]) |
| --- |

在这里，您可以使用匹配函数来获取行号或列号或两者都使用。

例子：

假设，从以下[图3.12](#fig3-12)中给出的数据中，我们需要找到总销售额，给定年份和季度。然后我们可以使用以下函数：

| =INDEX (数据库, MATCH (qtr 3, 列标题, 0), MATCH (year, 年份列, 0)) |
| --- |

![](images/Figure_3.12.png)

图3.12：Index-match函数

在以下[图3.13](#fig3-13)中，empcode是第三列。如果我们需要根据empcode找出DA或工资，通常会复制并粘贴列到左侧并使用vlookup。相反，我们可以使用如[图3.13](#fig3-13)中所示的index match：

![](images/Figure_3.13.png)

图3.13：通过使用Index match根据empcode找出DA或工资

[结论](contents.xhtml#sc2_53a)

总之，在Microsoft Excel中使用公式和函数对于进行计算、数据分析和自动化任务至关重要。公式允许用户结合数值、单元格引用和运算符进行数学计算，而函数提供了常见任务的预定义公式。通过有效利用公式和函数，用户可以节省时间，减少错误，并在Excel中进行复杂的数据分析。理解和掌握这些工具对于任何在Excel中处理数据和电子表格的人都至关重要。

[练习](contents.xhtml#sc2_54a)

1.  从高级Excel作业工作簿中复制工资工作表。计算以下激励方案：

    1.  激励1：所有在“销售”部门工作的人员将获得其工资的10%作为激励，其他人将获得0

    1.  激励2：所有在“销售”或“营销”部门工作的人员将获得其工资的5%作为激励，其他人将获得2%。

1.  使用V-lookup列计算Q.1 c中的激励方案。

1.  在工资列之后制作一个“汇报经理”列，并根据员工编号将经理的员工代码部署给员工，如下所示使用V-Lookup。

加入我们书籍的Discord空间

加入书籍的Discord Workspace，获取最新更新、优惠、全球技术动态、新发布和与作者的交流：

**[https://discord.bpbonline.com](https://discord.bpbonline.com)**

![](images/fm1.png)
